<!DOCTYPE HTML>
<!--
	Alpha by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>Residence casa carezza - Area Proprietari</title>
    <meta name="keywords"
          content="multiproprieta',multiproprieta,multiproprietà,time sharing,residence,resort,resorts,carezza,Carezza,CAREZZA,Karensee,karensee,residence casa carezza,Residence Casa Carezza,casacarezza,Casa Carezza,CASA CAREZZA,bolzano,Bolzano,bolzen,Ega,ega,garni casa carezza,Garni Casa Carezza, GARNI CASA CAREZZA,appartamenti in affitto,affitti turistici,affitto,montagna,vacanze,vacanze montagna,rci,RCI,r.c.i,R.C.I.scambio multiproprietà,acquisto multiproprietà,vendere multiproprietà">
    <meta id="meta-description" name="description"
          content="Area riservata di Residence Casa Carezza - Trova la tua settimana">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="stylesheet" href="assets/css/main.css"/>
</head>
<body class="is-preload">
<div id="page-wrapper">

    <!-- Header -->
    <header id="header">
        <h1><a href="index.html">sito ufficiale</a> @Casa Carezza</h1>
        <nav id="nav">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="prenota.html">Prenota</a></li>
                <li><a href="foto.html">Foto</a></li>
                <li><a href="contattaci.html">Contattaci</a></li>
                <li><a href="area_proprietari.html">Area Proprietari</a></li>
                <li>
                    <a href="#" class="icon fa-angle-down">Scopri</a>
                    <ul>
                        <li><a target="_blank" href="https://carezza.it">Lago Carezza</a></li>
                        <li><a target="_blank" href="https://eggental.com/it">I dintorni</a></li>
                        <li><a target="_blank" href="https://www.trentino.com/">Trentino</a></li>
                        <li><a target="_blank" href="https://www.dolomitisuperski.com/it">Dolomiti SuperSki</a></li>
                    </ul>
                </li>
                <!--<li><a href="#" class="button">Sign Up</a></li>-->
            </ul>
        </nav>
    </header>

    <!-- Main -->
    <section id="main" class="container medium">
        <header>
            <h2>Area Privata</h2>
        </header>
        <div class="box">
            <form name="login-in" style="display: none; text-align: center;">ENTRANDO NELLA TUA AREA PRIVATA</form>
            <form name="login" style="display: none;">
                <div class="row gtr-50 gtr-uniform">
                    <div class="col-6 col-12-mobilep">
                        <label>EMAIL:</label>
                        <input type="email" required name="email"/>
                    </div>
                    <div class="col-6 col-12-mobilep">
                        <label>&nbsp;</label>
                        <input type="submit" value="ENTRA"/>
                    </div>
                    <div id="result" style="text-align: center; width: 100%;">

                    </div>
                </div>
            </form>
            <form name="logged" style="display: none;">
                <div class="row gtr-50 gtr-uniform">
                    <div class="col-6 col-12-mobilep">
                        <label>ANNO:</label>
                        <select name="year">
                            <option value="2020">2020</option>
                            <option value="2021">2021</option>
                            <option value="2022">2022</option>
                            <option value="2023">2023</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2025">2026</option>
                            <option value="2025">2027</option>
                            <option value="2025">2028</option>
                            <option value="2025">2029</option>
                            <option value="2025">2030</option>
                        </select>
                    </div>
                    <div id="logged-result" style="width: 100%;">

                    </div>
                </div>
            </form>
        </div>
    </section>
    <!-- Footer -->
    <footer id="footer">
        <ul class="icons">
            <!--<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>-->
            <li><a target="_blank" href="https://www.facebook.com/www.casacarezza.it/?fref=ts" class="icon fa-facebook"><span
                    class="label">Facebook</span></a></li>
            <!--<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>-->
            <!--<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>-->
            <!--<li><a href="#" class="icon fa-dribbble"><span class="label">Dribbble</span></a></li>-->
            <!--<li><a href="#" class="icon fa-google-plus"><span class="label">Google+</span></a></li>-->
        </ul>
        <ul class="copyright">
            <li>&copy; Casa Carezza.</li>
            <!--<li>Design: <a href="http://html5up.net">HTML5 UP</a></li>-->
        </ul>
    </footer>

</div>

<!-- Scripts -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.dropotron.min.js"></script>
<script src="assets/js/jquery.scrollex.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-database.js"></script>
<script src="assets/js/init-firebase.js"></script>
<script src="assets/js/database-utils.js"></script>
<script src="assets/js/common-utils.js"></script>

<script>
    var database;

    function login(email) {
        var actionCodeSettings = {
            url: 'http://localhost:8080/area_privata.html',
            handleCodeInApp: true
        };
        firebase.auth().sendSignInLinkToEmail(email, actionCodeSettings)
            .then(function () {
                window.localStorage.setItem('emailForSignIn', email);
                alert('Controlla la tua mail per entrare nell \' area privata');
            })
            .catch(function (error) {
                console.log(error);
            });
    }

    document.forms['login'].addEventListener('submit', function (event) {
        event.preventDefault();
        login(document.forms['login']['email'].value);
    });

    if (firebase.auth().isSignInWithEmailLink(window.location.href)) {
        document.forms['login-in'].style.display = 'block';
        var email = window.localStorage.getItem('emailForSignIn');
        if (!email) {
            email = window.prompt('Please provide your email for confirmation');
        }
        firebase.auth().signInWithEmailLink(email, window.location.href)
            .then(function (result) {
                window.localStorage.removeItem('emailForSignIn');
                document.forms['login-in'].style.display = 'none';
                document.forms['logged'].style.display = 'block';
            })
            .catch(function (error) {
                document.forms['login'].style.display = 'block';
                document.forms['login-in'].style.display = 'none';
            });
    } else {
        getDatabase().then(function (db) {
            database = db;
            var email = 'massi.cattaneo.it@gmail.com';
            var user = db.users.find(function (item) {
                return item.emails.indexOf(email) !== -1;
            });
            var weeks = JSON.parse(JSON.stringify(db.weeks));

            var toDraw = user.properties.reduce(function (acc, prop) {
                var flat = prop.flat;
                var periodNum = prop.period;
                var period = db.periods.find(function (item) {
                    return item.number === periodNum;
                });
                return acc.concat(weeks.filter(function (item) {
                    return period.weeks.indexOf(item.number) !== -1;
                })).map(function (item) {
                    item.flat = flat;
                    item.period = periodNum;
                    return item;
                });
            }, []);


            function changeYear() {
                document.getElementById('logged-result').innerHTML = toDraw
                    .map(function (weekItem, index, array) {
                        var previous = array[index - 1] || {};
                        var flat = weekItem.flat;
                        var week = weekItem.number;
                        var year = Number(document.logged.year.value);
                        var findRent = weekItem.rent.find(function (i) {
                            return i.year === year;
                        }) || {};
                        var findExchange = weekItem.exchange.find(function (i) {
                            return i.year === year;
                        }) || {};
                        var flatPeriod = !(previous.period === weekItem.period && previous.flat === flat)
                            ? '<h3>APPARTEMENTO: ' + flat + ' - PERIODO: ' + weekItem.period + '</h3>'
                            : '';
                        var reservedFor = findRent.reserved ? 'RISERVATO PER AFFITTO' : (findExchange.reserved ? 'RISERVATO PER SCAMBIO' : '');
                        var label = '<span>' + getWeekDates(year, week) + '</span>';
                        var rent = '<input ' + (findRent.year ? 'checked' : '') + ' id="rent_' + week + '" type="checkbox" onchange="rent(' + year + ',' + week + ',' + flat + ')"/><label for="rent_' + week + '">AFFITTO</label>';
                        var exchange = '<input ' + (findExchange.year ? 'checked' : '') + ' id="exchange_' + week + '" type="checkbox" onchange="exchange(' + year + ',' + week + ',' + flat + ')"/><label for="exchange_' + week + '">SCAMBIO</label>';
                        return flatPeriod + label + '<br/>' + (reservedFor ? reservedFor + '<br/>' : rent + exchange);
                    }).join('<br/>');
            }

            document.forms['logged']['year'].addEventListener('change', changeYear);
            document.forms['logged'].style.display = 'block';
            changeYear();
        });
    }

    function rent(year, week, flat) {
        updateWeek(year, week, flat, 'rent');
    }

    function exchange(year, week, flat) {
        updateWeek(year, week, flat, 'exchange');
    }

    function updateWeek(year, week, flat, type) {
        var updates = {};
        var checked = document.forms['logged'][type + '_' + week].checked;
        var weekItem = database.weeks.find(function (item) {
            return item.number === Number(week);
        });
        if (checked) {
            weekItem[type].push({ year: year, reserved: false, flat: flat });
        } else {
            var item = weekItem[type].find(function (i) {
                return i.year === year && i.flat === flat;
            });
            var index = weekItem[type].indexOf(item);
            weekItem[type].splice(index, 1);
        }
        var item = JSON.parse(JSON.stringify(weekItem));
        delete item.key;
        updates['/weeks/' + weekItem.key] = item;
        return firebase.database().ref().update(updates);
    }
</script>
</body>
</html>
